<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS PRIME v52 | Debugged</title>
    <style>
        /* CSS VARIABLEN */
        :root {
            --bg-color: #0a0a0a;
            --card-bg: #141414;
            --accent: #00d4ff;     /* Standard Cyan */
            --text-main: #ffffff;
            --text-dim: #888888;
            --border: #333;
            --font-family: 'Inter', -apple-system, sans-serif;
        }

        /* BASIC RESET */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-family);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            padding-bottom: 100px; /* Platz f√ºr Nav */
            transition: background 0.3s;
        }

        /* HEADER */
        header {
            width: 100%;
            max-width: 800px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }
        .logo { font-size: 1.5rem; font-weight: bold; letter-spacing: 1px; }
        .logo span { color: var(--accent); }

        .btn {
            background: #222;
            border: 1px solid #333;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            margin-left: 5px;
        }
        .btn:hover { border-color: var(--accent); color: var(--accent); }

        /* LAYOUTS (Werden per JS ein/ausgeschaltet) */
        #layout-classic, #layout-modern {
            width: 100%;
            max-width: 800px;
            display: none; /* Erstmal alles aus */
        }
        /* Grid Styles wenn aktiv */
        .grid-active { display: grid !important; grid-template-columns: 1fr; gap: 20px; }
        @media(min-width: 600px) {
            #layout-classic.grid-active { grid-template-columns: repeat(2, 1fr); }
        }

        /* CARDS */
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
        }
        h2 { font-size: 0.9rem; color: var(--text-dim); text-transform: uppercase; margin-bottom: 10px; }

        /* INPUTS */
        textarea {
            width: 100%;
            background: #111;
            border: 1px solid #333;
            color: white;
            padding: 10px;
            border-radius: 8px;
            min-height: 150px;
            resize: vertical;
        }
        textarea:focus { border-color: var(--accent); outline: none; }

        /* BOTTOM NAV */
        .nav-bar {
            position: fixed; bottom: 20px;
            background: rgba(20,20,20,0.9);
            backdrop-filter: blur(10px);
            border: 1px solid #333;
            border-radius: 50px;
            display: flex; gap: 30px; padding: 15px 30px;
            z-index: 1000;
        }
        .nav-icon { font-size: 1.5rem; cursor: pointer; opacity: 0.5; transition: 0.2s; }
        .nav-icon.active { opacity: 1; color: var(--accent); transform: scale(1.1); }

        /* COLOR MENU */
        #color-picker {
            display: none;
            position: absolute; top: 70px; right: 20px;
            background: #222; padding: 10px;
            border-radius: 8px; border: 1px solid #444;
            z-index: 2000;
        }
        .dot { width: 25px; height: 25px; border-radius: 50%; display: inline-block; margin: 3px; cursor: pointer; border: 2px solid transparent; }
        .dot:hover { border-color: white; }

        /* WIDGETS */
        .time { font-size: 2.5rem; font-weight: bold; text-align: center; }
        .date { text-align: center; color: var(--accent); margin-bottom: 10px; }

    </style>
</head>
<body>

    <header>
        <div class="logo">NEXUS <span>PRIME</span></div>
        <div>
            <button class="btn" onclick="toggleColors()">üé®</button>
            <button class="btn" onclick="toggleLayout()">Layout: <span id="mode-label">Classic</span></button>
        </div>
    </header>

    <!-- Color Picker -->
    <div id="color-picker">
        <div class="dot" style="background:#00d4ff" onclick="setTheme('#00d4ff')"></div>
        <div class="dot" style="background:#ff0055" onclick="setTheme('#ff0055')"></div>
        <div class="dot" style="background:#00ff88" onclick="setTheme('#00ff88')"></div>
        <div class="dot" style="background:#ffcc00" onclick="setTheme('#ffcc00')"></div>
    </div>

    <!-- === CLASSIC LAYOUT === -->
    <div id="layout-classic">
        
        <!-- Tab 1: Home -->
        <div id="view-home" class="view-section">
            <div class="card">
                <h2>Zeit</h2>
                <div class="time" id="clock-c">00:00</div>
                <div class="date" id="date-c">...</div>
            </div>
            <div class="card" style="margin-top:20px">
                <h2>Quick Notes</h2>
                <textarea id="in-quick" placeholder="Notizen..." oninput="triggerSave()"></textarea>
            </div>
        </div>

        <!-- Tab 2: Journal -->
        <div id="view-journal" class="view-section" style="display:none">
            <div class="card">
                <h2>Tagebuch</h2>
                <textarea style="height:400px" id="in-journal" placeholder="Liebes Tagebuch..." oninput="triggerSave()"></textarea>
            </div>
        </div>

        <!-- Tab 3: Finance -->
        <div id="view-finance" class="view-section" style="display:none">
            <div class="card" style="height:500px">
                <h2>Markt</h2>
                <!-- TradingView -->
                <div class="tradingview-widget-container" style="height:100%;width:100%">
                    <div class="tradingview-widget-container__widget" style="height:100%;width:100%"></div>
                    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>
                    { "colorTheme": "dark", "dateRange": "12M", "showChart": true, "locale": "de_DE", "width": "100%", "height": "100%", "isTransparent": true, "tabs": [{"title": "Portfolio","symbols": [{"s": "XETR:IUSQ"}, {"s": "TVC:GOLD"}]}] }
                    </script>
                </div>
            </div>
        </div>
    </div>

    <!-- === MODERN LAYOUT === -->
    <div id="layout-modern">
        <div class="card" style="text-align:center; background:transparent; border:none;">
            <div class="time" id="clock-m" style="font-size:4rem; opacity:0.5;">00:00</div>
        </div>
        <div class="card">
            <h2>Deep Focus</h2>
            <textarea style="height:500px; font-size:1.2rem;" id="in-focus" placeholder="Focus Mode..." oninput="triggerSave()"></textarea>
        </div>
    </div>

    <!-- NAVIGATION (Nur Classic) -->
    <div class="nav-bar" id="bottom-nav">
        <div class="nav-icon active" onclick="switchView('home', this)">üè†</div>
        <div class="nav-icon" onclick="switchView('journal', this)">üìñ</div>
        <div class="nav-icon" onclick="switchView('finance', this)">üìà</div>
        <span id="cloud-status" style="font-size:0.7rem; color:#555; align-self:center;">Init</span>
    </div>

    <script>
        // ============================
        // CONFIG
        // ============================
        const API_KEY = $2a$10$bfQHPAKf8rHB5nCB1nxla.8UbbBLCu6uCSZjrrePZ2JvQv9Jw3XEK; 
        const BIN_ID  = 6983be0443b1c97be965d28c;
        // ============================

        // 1. STARTUP
        window.addEventListener('load', () => {
            updateClock();
            setInterval(updateClock, 1000);
            
            // Layout setzen
            document.getElementById('layout-classic').classList.add('grid-active');
            
            // Cloud laden
            loadData();
        });

        // 2. UHRZEIT (Safe Mode)
        function updateClock() {
            const now = new Date();
            const t = now.toLocaleTimeString('de-DE', {hour:'2-digit', minute:'2-digit'});
            const d = now.toLocaleDateString('de-DE');
            
            const cc = document.getElementById('clock-c');
            if(cc) cc.innerText = t;
            const cm = document.getElementById('clock-m');
            if(cm) cm.innerText = t;
            
            const dc = document.getElementById('date-c');
            if(dc) dc.innerText = d;
        }

        // 3. LAYOUT SWITCHER
        function toggleLayout() {
            const classic = document.getElementById('layout-classic');
            const modern = document.getElementById('layout-modern');
            const nav = document.getElementById('bottom-nav');
            const label = document.getElementById('mode-label');

            if(classic.classList.contains('grid-active')) {
                // Switch to Modern
                classic.classList.remove('grid-active');
                modern.classList.add('grid-active');
                nav.style.display = 'none';
                label.innerText = "Modern";
            } else {
                // Switch to Classic
                modern.classList.remove('grid-active');
                classic.classList.add('grid-active');
                nav.style.display = 'flex';
                label.innerText = "Classic";
            }
        }

        // 4. TAB SWITCHER (Innerhalb Classic)
        function switchView(viewName, btn) {
            // Alle ausblenden
            document.getElementById('view-home').style.display = 'none';
            document.getElementById('view-journal').style.display = 'none';
            document.getElementById('view-finance').style.display = 'none';
            
            // Gew√§hlten anzeigen
            document.getElementById('view-' + viewName).style.display = 'block';

            // Icons reset
            document.querySelectorAll('.nav-icon').forEach(icon => icon.classList.remove('active'));
            btn.classList.add('active');
        }

        // 5. COLORS
        function toggleColors() {
            const p = document.getElementById('color-picker');
            p.style.display = p.style.display === 'block' ? 'none' : 'block';
        }
        function setTheme(color) {
            document.documentElement.style.setProperty('--accent', color);
            toggleColors();
        }

        // 6. CLOUD SYNC
        let saveTimer;
        
        async function loadData() {
            const st = document.getElementById('cloud-status');
            st.innerText = "Syncing...";
            try {
                let res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {headers: {"X-Master-Key": API_KEY}});
                let json = await res.json();
                let data = json.record;

                if(data.quick) document.getElementById('in-quick').value = data.quick;
                if(data.journal) document.getElementById('in-journal').value = data.journal;
                if(data.focus) document.getElementById('in-focus').value = data.focus;

                st.innerText = "Online";
                st.style.color = "var(--accent)";
            } catch(e) {
                console.error(e);
                st.innerText = "Offline";
            }
        }

        function triggerSave() {
            clearTimeout(saveTimer);
            document.getElementById('cloud-status').innerText = "Typing...";
            saveTimer = setTimeout(saveData, 2000);
        }

        async function saveData() {
            const st = document.getElementById('cloud-status');
            st.innerText = "Saving...";
            
            let payload = {
                quick: document.getElementById('in-quick').value,
                journal: document.getElementById('in-journal').value,
                focus: document.getElementById('in-focus').value
            };

            try {
                await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                    method: "PUT",
                    headers: { "Content-Type": "application/json", "X-Master-Key": API_KEY },
                    body: JSON.stringify(payload)
                });
                st.innerText = "Saved";
            } catch(e) {
                st.innerText = "Error";
            }
        }

    </script>
</body>
</html>
