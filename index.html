<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS PRIME v40 | Autopilot</title>
    <style>
        :root {
            --bg-color: #0a0a0a;
            --card-bg: #141414;
            --accent: #00d4ff;     /* Cyan Neon */
            --accent-2: #ff0055;   /* Alert Red */
            --text-main: #ffffff;
            --text-dim: #888888;
            --border: #333;
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, monospace;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-family);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        /* HEADER */
        header {
            width: 100%;
            max-width: 1000px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }

        .logo { font-size: 1.5rem; font-weight: 700; letter-spacing: 2px; text-transform: uppercase; }
        .logo span { color: var(--accent); }
        .status-badge { 
            font-size: 0.75rem; 
            background: #1a1a1a; 
            padding: 5px 10px; 
            border-radius: 4px; 
            border: 1px solid #333;
            color: var(--text-dim);
            transition: all 0.3s ease;
        }
        .status-badge.saving { border-color: var(--accent); color: var(--accent); }
        .status-badge.error { border-color: var(--accent-2); color: var(--accent-2); }

        /* TICKER */
        .news-container {
            width: 100%;
            max-width: 1000px;
            background: #111;
            border: 1px solid #222;
            border-radius: 4px;
            margin-bottom: 30px;
            overflow: hidden;
            white-space: nowrap;
        }
        .news-ticker {
            display: inline-block;
            padding: 8px 0;
            font-size: 0.85rem;
            color: var(--text-dim);
            padding-left: 100%;
            animation: ticker 40s linear infinite;
        }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }

        /* GRID */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 1000px;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 25px;
            display: flex;
            flex-direction: column;
        }

        h2 { font-size: 0.9rem; margin-bottom: 20px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1.5px; }

        /* WIDGETS */
        .time-display { font-size: 3.5rem; font-weight: 700; letter-spacing: -2px; line-height: 1; margin-bottom: 5px; }
        .date-display { color: var(--accent); font-size: 1rem; margin-bottom: 20px; }

        /* AI CHAT */
        #ai-response {
            background: #000;
            border-left: 2px solid var(--accent);
            padding: 15px;
            border-radius: 0 6px 6px 0;
            margin-bottom: 15px;
            font-size: 0.95rem;
            line-height: 1.6;
            min-height: 60px;
        }
        input[type="text"], textarea {
            width: 100%;
            background: #222;
            border: 1px solid #333;
            color: white;
            padding: 12px;
            border-radius: 6px;
            font-family: inherit;
            margin-bottom: 10px;
            outline: none;
        }
        input[type="text"]:focus, textarea:focus { border-color: var(--accent); }
        
        button {
            background: var(--accent);
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
        }
        button:hover { filter: brightness(1.1); }

        /* TODO LIST (EDITABLE FOR CLOUD) */
        .todo-area {
            width: 100%;
            height: 200px;
            background: #0f0f0f;
            resize: none;
            font-size: 0.9rem;
            line-height: 1.7;
        }

        /* STRESS SLIDER */
        input[type=range] {
            width: 100%;
            background: #333;
            height: 4px;
            border-radius: 2px;
            -webkit-appearance: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            margin-top: -6px; /* align center */
        }
        input[type=range]::-webkit-slider-runnable-track { height: 4px; background: #333; }
        
    </style>
</head>
<body>

    <header>
        <div class="logo">NEXUS <span>PRIME</span></div>
        <div class="status-badge" id="cloudStatus">System Ready</div>
    </header>

    <div class="news-container">
        <div class="news-ticker" id="newsTicker">+++ NEXUS PRIME v40 Online +++ Automatische Synchronisation aktiv +++ Märkte beobachten +++ Fokus halten +++</div>
    </div>

    <div class="dashboard">

        <!-- 1. TIME & DATE -->
        <div class="card">
            <h2>Chronometer</h2>
            <div class="time-display" id="clock">00:00</div>
            <div class="date-display" id="date">Lade...</div>
            
            <div style="margin-top: auto;">
                <label style="color: #666; font-size: 0.8rem; display:block; margin-bottom:10px;">Stress Level Monitor</label>
                <input type="range" min="1" max="10" value="5" id="stressRange" oninput="updateStressDisplay(this.value)">
                <div id="stressText" style="margin-top: 5px; font-size: 0.9rem; color: var(--text-main);">Normal (5/10)</div>
            </div>
        </div>

        <!-- 2. AI NEURAL CORE -->
        <div class="card">
            <h2>Neural Core (AI)</h2>
            <div id="ai-response">Bereit zur Analyse.</div>
            <input type="text" id="userInput" placeholder="Befehl eingeben..." onkeypress="handleEnter(event)">
            <button onclick="askAI()">Ausführen</button>
        </div>

        <!-- 3. FINANCE (TRADINGVIEW) -->
        <div class="card" style="grid-row: span 2;">
            <h2>Market Data</h2>
            <div style="height: 100%; min-height: 400px;">
                <!-- TradingView Widget BEGIN -->
                <div class="tradingview-widget-container" style="height:100%;width:100%">
                    <div class="tradingview-widget-container__widget" style="height:calc(100% - 32px);width:100%"></div>
                    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>
                    {
                    "colorTheme": "dark",
                    "dateRange": "12M",
                    "showChart": true,
                    "locale": "de_DE",
                    "width": "100%",
                    "height": "100%",
                    "largeChartUrl": "",
                    "isTransparent": true,
                    "showSymbolLogo": true,
                    "tabs": [
                        {
                        "title": "Assets",
                        "symbols": [
                            { "s": "XETR:IUSQ", "d": "MSCI ACWI" },
                            { "s": "TVC:GOLD", "d": "Gold" },
                            { "s": "TVC:SILVER", "d": "Silver" },
                            { "s": "BITSTAMP:BTCUSD", "d": "Bitcoin" }
                        ]
                        }
                    ]
                    }
                    </script>
                </div>
                <!-- TradingView Widget END -->
            </div>
        </div>

        <!-- 4. DAILY PROTOCOL (CLOUD SYNCED) -->
        <div class="card">
            <h2>Daily Protocol & Notes</h2>
            <textarea class="todo-area" id="dailyNotes" placeholder="Hier deinen Tagesplan oder Notizen reinschreiben. Speichert automatisch..."></textarea>
        </div>

    </div>

    <script>
        // ==========================================
        // KONFIGURATION (HIER EINTAGEN!)
        // ==========================================
        const API_KEY = $2a$10$bfQHPAKf8rHB5nCB1nxla.8UbbBLCu6uCSZjrrePZ2JvQv9Jw3XEK; 
        const BIN_ID  = 6983be0443b1c97be965d28c;
        // ==========================================

        // --- 1. CLOUD SYSTEM (AUTOPILOT) ---
        
        // Daten laden beim Start
        window.onload = function() {
            loadFromCloud();
            updateTime();
        };

        async function loadFromCloud() {
            const status = document.getElementById('cloudStatus');
            status.innerText = "Syncing...";
            
            try {
                let response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                    headers: { "X-Master-Key": API_KEY }
                });
                
                if (response.ok) {
                    let json = await response.json();
                    let data = json.record;
                    
                    // Daten in die Felder füllen
                    if(data.notes) document.getElementById('dailyNotes').value = data.notes;
                    if(data.stress) {
                        document.getElementById('stressRange').value = data.stress;
                        updateStressDisplay(data.stress);
                    }
                    status.innerText = "Connected v40";
                    status.style.color = "#00d4ff";
                } else {
                    status.innerText = "Sync Error";
                    status.className = "status-badge error";
                }
            } catch (error) {
                console.error(error);
                status.innerText = "Offline Mode";
            }
        }

        async function saveToCloud() {
            const status = document.getElementById('cloudStatus');
            status.innerText = "Auto-Saving...";
            status.className = "status-badge saving";

            // Daten sammeln
            let dataToSave = {
                notes: document.getElementById('dailyNotes').value,
                stress: document.getElementById('stressRange').value,
                lastUpdate: new Date().toISOString()
            };

            try {
                let response = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json",
                        "X-Master-Key": API_KEY
                    },
                    body: JSON.stringify(dataToSave)
                });

                if (response.ok) {
                    status.innerText = "Saved " + new Date().toLocaleTimeString();
                    status.className = "status-badge";
                    status.style.color = "#00d4ff";
                } else {
                    status.innerText = "Save Failed";
                    status.className = "status-badge error";
                }
            } catch (e) {
                status.innerText = "Connection Lost";
            }
        }

        // --- 2. AUTOPILOT LOGIC (TRIGGERT SAVE) ---
        let typingTimer;
        const doneTypingInterval = 2000; // 2 Sekunden warten nach Tippen

        // Überwache Textfeld und Slider
        document.getElementById('dailyNotes').addEventListener('input', startAutoSaveTimer);
        document.getElementById('stressRange').addEventListener('change', saveToCloud); // Slider speichert sofort beim Loslassen

        function startAutoSaveTimer() {
            clearTimeout(typingTimer);
            document.getElementById('cloudStatus').innerText = "Typing...";
            typingTimer = setTimeout(saveToCloud, doneTypingInterval);
        }

        // --- 3. BASIC FEATURES ---

        function updateTime() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('de-DE', {hour:'2-digit', minute:'2-digit'});
            document.getElementById('date').innerText = now.toLocaleDateString('de-DE', {weekday:'long', day:'numeric', month:'long'});
        }
        setInterval(updateTime, 1000);

        function updateStressDisplay(val) {
            let text = "Normal";
            if(val < 4) text = "Relaxed";
            if(val > 7) text = "HIGH ALERT";
            document.getElementById('stressText').innerText = `${text} (${val}/10)`;
        }

        // --- 4. NEURAL CORE (AI LOGIC) ---
        
        function handleEnter(e) { if(e.key === 'Enter') askAI(); }

        function askAI() {
            const input = document.getElementById('userInput').value.toLowerCase();
            const output = document.getElementById('ai-response');
            let response = "Verarbeite Daten...";

            if(input.includes("hallo")) response = "NEXUS v40 Online. Systeme laufen stabil.";
            else if(input.includes("stress")) response = "Stresslevel wird überwacht. Empfehlung: Atme tief durch.";
            else if(input.includes("börse")) response = "Finanzdaten siehe unten. Markt ist volatil.";
            else if(input.includes("lernen") || input.includes("schule")) response = "Fokus-Modus empfohlen. Handy weg, Timer auf 45min.";
            else response = "Eingabe registriert. Ergänze deinen Tagesplan im Protokoll.";

            output.innerText = response;
            document.getElementById('userInput').value = "";
        }

    </script>
</body>
</html>
