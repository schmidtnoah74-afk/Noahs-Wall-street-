<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Noah Daymaker- FIXED</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-body: #050510;
            --card-bg: #1a1a2e;
            --primary: #00f2ff;
            --text-main: #ffffff;
            --text-dim: #8888aa;
            --nav-bg: #141420;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0;
            background-color: var(--bg-body);
            font-family: 'Inter', sans-serif;
            color: var(--text-main);
            height: 100vh;
            display: flex; flex-direction: column;
            overflow: hidden;
        }

        /* --- HEADER --- */
        header {
            padding: 15px 20px;
            background: rgba(20, 20, 40, 0.95);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex; justify-content: space-between; align-items: center;
            z-index: 100;
            height: 70px; /* Feste H√∂he */
        }
        .logo { font-weight: 900; font-size: 1.2rem; color: var(--primary); letter-spacing: 1px; }
        .clock-container { text-align: right; }
        .live-time { font-family: monospace; font-size: 1.3rem; font-weight: bold; color: #fff; line-height: 1; }
        .live-date { font-size: 0.75rem; color: var(--text-dim); margin-top: 4px; }

        /* --- SWIPER LAYOUT --- */
        .swiper-container {
            flex: 1; 
            display: flex; 
            overflow-x: auto;
            overflow-y: hidden; /* Wichtig */
            scroll-snap-type: x mandatory; 
            scroll-behavior: smooth;
        }
        .page {
            min-width: 100%; /* 100% vom Container */
            height: 100%; 
            scroll-snap-align: start;
            overflow-y: auto; 
            padding: 20px; 
            padding-bottom: 100px; /* Platz f√ºr Nav */
        }

        h2 { font-size: 0.9rem; text-transform: uppercase; color: var(--text-dim); margin-bottom: 15px; letter-spacing: 1px; display: flex; align-items: center; gap: 8px; }
        
        .card {
            background: var(--card-bg);
            border-radius: 16px; padding: 20px; margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        /* --- TASKS --- */
        .task-item {
            padding: 15px; border-radius: 12px; margin-bottom: 10px;
            display: flex; align-items: center; gap: 15px;
            color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        /* Bunte Hintergr√ºnde */
        .task-finanzen { background: linear-gradient(135deg, #f1c40f, #b7950b); color: #000; }
        .task-schule   { background: linear-gradient(135deg, #3498db, #2980b9); }
        .task-sport    { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .task-haus     { background: linear-gradient(135deg, #2ecc71, #27ae60); color: #000; }

        .task-time { font-weight: 800; font-size: 1.1rem; opacity: 0.9; width: 50px; }
        .task-info { flex: 1; }
        .task-title { font-weight: 600; font-size: 1rem; }
        .task-badge { font-size: 0.6rem; text-transform: uppercase; opacity: 0.8; font-weight: bold; border: 1px solid rgba(255,255,255,0.3); padding: 2px 6px; border-radius: 4px; display: inline-block; margin-bottom: 4px;}

        /* --- CONTROLS --- */
        .cal-controls { display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 12px; margin-bottom: 15px; }
        .cal-btn { background: rgba(255,255,255,0.1); border: none; color: white; width: 40px; height: 40px; border-radius: 8px; font-size: 1rem; cursor: pointer; }
        
        /* Das neue Datum-Input Feld */
        .date-input-styled {
            background: var(--primary);
            color: black;
            border: none;
            padding: 10px;
            border-radius: 8px;
            font-weight: bold;
            font-family: inherit;
            text-align: center;
            width: 100%;
            display: block;
            margin-top: 10px;
            font-size: 1rem;
        }

        /* --- KI & FORMULARE --- */
        .ai-box { background: linear-gradient(135deg, #2a0845, #6441a5); color: white; }
        .chat-bubble { background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; margin-bottom: 10px; border-left: 3px solid #fff; }
        .response-area { display: none; margin-top: 10px; }
        .mood-btn { flex: 1; padding: 10px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }

        input[type="text"], input[type="time"], select {
            width: 100%; padding: 12px; margin-bottom: 10px;
            background: rgba(0,0,0,0.3); border: 1px solid #444; color: white; border-radius: 8px;
            font-size: 1rem;
        }
        .add-btn { width: 100%; background: var(--primary); padding: 15px; border: none; border-radius: 8px; font-weight: bold; font-size: 1rem; color: #000; text-transform: uppercase; cursor: pointer; }

        /* --- NAV BAR (FIXED) --- */
        .nav-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 70px;
            background: var(--nav-bg); border-top: 1px solid #333;
            display: flex; justify-content: space-around; align-items: center;
            z-index: 200;
        }
        .nav-item { color: #666; font-size: 1.5rem; background: none; border: none; display: flex; flex-direction: column; align-items: center; cursor: pointer; transition: color 0.2s; }
        
        /* Aktiver Zustand deutlicher */
        .nav-item.active { color: var(--primary); transform: scale(1.1); }
        .nav-text { font-size: 0.6rem; margin-top: 5px; }

        /* Notification */
        .notify {
            position: fixed; top: 10px; left: 50%; transform: translateX(-50%);
            background: var(--primary); color: #000; padding: 10px 20px; border-radius: 20px;
            font-weight: bold; display: none; z-index: 1000;
        }
        
        .tradingview-widget-container { height: 350px !important; width: 100% !important; border-radius: 12px; overflow: hidden; }

    </style>
</head>
<body>

    <div id="notify" class="notify">Gespeichert!</div>

    <header>
        <div class="logo">NOAH<span style="color:white">PRO</span> v7</div>
        <div class="clock-container">
            <div id="clock" class="live-time">--:--:--</div>
            <div id="headerDate" class="live-date">Lade...</div>
        </div>
    </header>

    <div class="swiper-container" id="swiper">
        
        <!-- SEITE 1: KI -->
        <div class="page">
            <div class="card ai-box">
                <h2><i class="fas fa-robot"></i> KI Assistant</h2>
                <div id="ai-question" class="chat-bubble">"Hey Noah! Wie lief der Tag bis jetzt?"</div>
                
                <div id="ai-options" style="display:flex; gap:10px;">
                    <button onclick="aiStep1('good')" class="mood-btn" style="background:#2ecc71;">Top</button>
                    <button onclick="aiStep1('mid')" class="mood-btn" style="background:#f1c40f;">Geht so</button>
                    <button onclick="aiStep1('bad')" class="mood-btn" style="background:#e74c3c; color:white;">Schlecht</button>
                </div>

                <div id="ai-input-area" class="response-area">
                    <input type="text" id="ai-text-input" placeholder="Erz√§hl mir kurz mehr..." style="background:rgba(255,255,255,0.2); border:none;">
                    <button onclick="aiStep2()" style="width:100%; padding:10px; background:white; color:black; border:none; border-radius:8px; font-weight:bold;">Antworten <i class="fas fa-paper-plane"></i></button>
                </div>
            </div>

            <div class="card">
                <h2><i class="fas fa-newspaper"></i> News</h2>
                <div style="font-size:0.9rem; line-height:1.6; opacity:0.8;">
                    ‚Ä¢ DAX Analyse: Rekordhoch in Sicht?<br>
                    ‚Ä¢ Bitcoin Update: ETF Zufl√ºsse steigen<br>
                    ‚Ä¢ Schule/Abi: Termine f√ºr Pr√ºfungen beachten
                </div>
            </div>
        </div>

        <!-- SEITE 2: PLANER -->
        <div class="page">
            <div class="card">
                <h2><i class="far fa-calendar-alt"></i> Steuerung</h2>
                
                <!-- Tag Wechseln -->
                <div class="cal-controls">
                    <button class="cal-btn" onclick="addDays(-1)"><i class="fas fa-chevron-left"></i></button>
                    <div style="text-align:center;">
                        <div id="currentDayDisplay" style="font-weight:bold;">Heute</div>
                    </div>
                    <button class="cal-btn" onclick="addDays(1)"><i class="fas fa-chevron-right"></i></button>
                </div>

                <!-- Zoom / Kalender Eingabe -->
                <label style="font-size:0.8rem; color:#888;">Gehe zu Datum (Zoom):</label>
                <input type="date" id="datePickerInput" class="date-input-styled" onchange="pickDate(this.value)">
            </div>

            <div id="taskList">
                <!-- Aufgaben hier -->
            </div>

            <div class="card">
                <h2>Eintrag hinzuf√ºgen</h2>
                <input type="text" id="tTitle" placeholder="Titel...">
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <input type="time" id="tTime">
                    <select id="tCat">
                        <option value="schule">Schule</option>
                        <option value="finanzen">Finanzen</option>
                        <option value="sport">Sport</option>
                        <option value="haus">Haus</option>
                    </select>
                </div>
                <button class="add-btn" onclick="addTask()">Speichern</button>
            </div>
        </div>

        <!-- SEITE 3: FINANZEN -->
        <div class="page">
            <div class="card">
                <h2><i class="fas fa-chart-line"></i> M√§rkte</h2>
                <div class="tradingview-widget-container">
                    <div class="tradingview-widget-container__widget"></div>
                    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>
                    { "colorTheme": "dark", "dateRange": "12M", "showChart": true, "locale": "de_DE", "width": "100%", "height": "350", "isTransparent": true, "tabs": [{"title": "Indizes", "symbols": [{"s": "FOREXCOM:SPXUSD"}, {"s": "INDEX:DEU40"}]}, {"title": "Krypto", "symbols": [{"s": "BITSTAMP:BTCUSD"}, {"s": "BITSTAMP:ETHUSD"}]}] }
                    </script>
                </div>
            </div>
        </div>
    </div>

    <nav class="nav-bar">
        <button class="nav-item active" onclick="goto(0)"><i class="fas fa-brain"></i><span class="nav-text">KI</span></button>
        <button class="nav-item" onclick="goto(1)"><i class="fas fa-list"></i><span class="nav-text">Planer</span></button>
        <button class="nav-item" onclick="goto(2)"><i class="fas fa-chart-pie"></i><span class="nav-text">Finanzen</span></button>
    </nav>

    <script>
        // --- 1. UHRZEIT & INIT ---
        // Wir warten, bis die Seite komplett geladen ist, um Fehler zu vermeiden
        window.addEventListener('load', () => {
            updateClock();
            setInterval(updateClock, 1000);
            
            // Initiale Anzeige
            render();
            updateActiveNav(0);
        });

        function updateClock() {
            const now = new Date();
            // Sicherstellen, dass die Elemente existieren
            const clockEl = document.getElementById('clock');
            const dateEl = document.getElementById('headerDate');
            
            if(clockEl) clockEl.innerText = now.toLocaleTimeString('de-DE');
            if(dateEl) dateEl.innerText = now.toLocaleDateString('de-DE', { weekday: 'short', day: '2-digit', month: 'long' });
        }

        // --- 2. LOGIC (STATE) ---
        let viewDate = new Date();
        // Daten aus LocalStorage laden
        let tasks = JSON.parse(localStorage.getItem('noahTasksV7')) || {};

        function getDateKey(d) { return d.toISOString().split('T')[0]; }

        function render() {
            const key = getDateKey(viewDate);
            const list = document.getElementById('taskList');
            const dateInput = document.getElementById('datePickerInput');
            
            // Setze das Datum im Input-Feld, damit man sieht, wo man ist
            if(dateInput) dateInput.value = key;

            // Header Text
            const today = getDateKey(new Date());
            const dayText = document.getElementById('currentDayDisplay');
            if(dayText) dayText.innerText = (key === today) ? "HEUTE" : viewDate.toLocaleDateString('de-DE', {weekday:'long', day:'2-digit', month:'2-digit'});

            // Aufgaben rendern
            list.innerHTML = '';
            const dayTasks = tasks[key] || [];
            dayTasks.sort((a,b) => a.time.localeCompare(b.time));

            if(dayTasks.length === 0) {
                list.innerHTML = `<div style="text-align:center; opacity:0.3; padding:20px;">Keine Aufgaben</div>`;
            } else {
                dayTasks.forEach((t, i) => {
                    list.innerHTML += `
                    <div class="task-item task-${t.cat}" style="${t.done ? 'opacity:0.4; text-decoration:line-through' : ''}" onclick="toggle(${i})">
                        <div class="task-time">${t.time}</div>
                        <div class="task-info">
                            <div class="task-badge">${t.cat}</div>
                            <div class="task-title">${t.title}</div>
                        </div>
                        <i class="fas fa-trash" onclick="del(event, ${i})"></i>
                    </div>`;
                });
            }
        }

        // --- 3. ACTIONS ---
        function addTask() {
            const title = document.getElementById('tTitle').value;
            const time = document.getElementById('tTime').value;
            const cat = document.getElementById('tCat').value;
            
            if(!title || !time) return alert("Fehlt was!");

            const key = getDateKey(viewDate);
            if(!tasks[key]) tasks[key] = [];
            tasks[key].push({title, time, cat, done:false});
            
            localStorage.setItem('noahTasksV7', JSON.stringify(tasks));
            document.getElementById('tTitle').value = '';
            render();
            showNotify();
        }

        function toggle(i) {
            const key = getDateKey(viewDate);
            tasks[key][i].done = !tasks[key][i].done;
            localStorage.setItem('noahTasksV7', JSON.stringify(tasks));
            render();
        }

        function del(e, i) {
            e.stopPropagation();
            if(confirm("L√∂schen?")) {
                const key = getDateKey(viewDate);
                tasks[key].splice(i, 1);
                localStorage.setItem('noahTasksV7', JSON.stringify(tasks));
                render();
            }
        }

        // --- 4. NAVIGATION & CALENDAR ---
        function addDays(n) {
            viewDate.setDate(viewDate.getDate() + n);
            render();
        }

        function pickDate(val) {
            if(!val) return;
            viewDate = new Date(val);
            render();
        }

        // --- 5. NAVIGATION BAR FIX ---
        const swiper = document.getElementById('swiper');
        const navItems = document.querySelectorAll('.nav-item');

        function goto(idx) {
            // Scrollen
            const width = swiper.clientWidth; // Exakte Breite holen
            swiper.scrollTo({left: idx * width, behavior:'smooth'});
            updateActiveNav(idx);
        }
        
        // Scroll Event mit besserer Berechnung
        swiper.addEventListener('scroll', () => {
            const width = swiper.clientWidth;
            // Wenn Breite 0 ist (Fehlerfall), abbrechen
            if(width === 0) return;
            
            const idx = Math.round(swiper.scrollLeft / width);
            updateActiveNav(idx);
        });

        function updateActiveNav(idx) {
            navItems.forEach(n => n.classList.remove('active'));
            if(navItems[idx]) navItems[idx].classList.add('active');
        }

        // --- 6. KI ---
        function aiStep1(mood) {
            document.getElementById('ai-options').style.display = 'none';
            document.getElementById('ai-input-area').style.display = 'block';
            const q = document.getElementById('ai-question');
            
            if(mood === 'good') q.innerText = "Stark! Was war das Highlight?";
            else if(mood === 'mid') q.innerText = "Okay. Was hat gefehlt?";
            else q.innerText = "Oh je. Woran lag es?";
        }

        function aiStep2() {
            document.getElementById('ai-input-area').style.display = 'none';
            document.getElementById('ai-question').innerText = "Notiert! Morgen wird besser. üöÄ";
            showNotify();
        }

        function showNotify() {
            const n = document.getElementById('notify');
            n.style.display = 'block';
            setTimeout(() => n.style.display='none', 2000);
        }

    </script>
</body>
</html>
