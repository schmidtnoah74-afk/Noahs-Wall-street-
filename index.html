<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEXUS CLASSIC</title>
    <style>
        :root {
            --primary: #8a2be2; /* Standard: Lila */
            --bg: #121212;
            --card: #1e1e1e;
            --text: #ffffff;
            --text-sec: #aaaaaa;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* HEADER */
        .header {
            padding: 15px;
            background: rgba(30, 30, 30, 0.95);
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            z-index: 100;
        }

        .header h1 { margin: 0; font-size: 20px; font-weight: 700; letter-spacing: 1px; }
        
        .header-controls { display: flex; gap: 10px; }
        .icon-btn { 
            background: none; border: none; font-size: 18px; cursor: pointer; color: var(--primary);
            padding: 5px;
        }

        /* MAIN CONTENT AREA */
        .content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 80px; /* Platz f√ºr Nav unten */
        }

        .view-section { display: none; animation: fadeIn 0.3s ease; }
        .view-section.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* PLANNER & CALENDAR */
        .date-control {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--card);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .date-display { font-weight: bold; font-size: 16px; }

        .task-input-group {
            background: var(--card);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .row { display: flex; gap: 10px; }
        input, select, textarea {
            background: #2a2a2a;
            border: 1px solid #333;
            color: white;
            padding: 10px;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
        }
        input:focus, select:focus { border-color: var(--primary); }

        button.add-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 5px;
        }
        
        button.opt-btn {
            background: linear-gradient(45deg, #ff0080, #ff8c00);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 15px;
            width: 100%;
            cursor: pointer;
        }

        /* TASK LIST */
        .task-item {
            display: flex;
            align-items: center;
            background: var(--card);
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }
        /* Kategorien Farben */
        .cat-finanzen { border-left-color: #ffd700 !important; } /* Gold */
        .cat-schule { border-left-color: #1e90ff !important; } /* Blau */
        .cat-hausarbeit { border-left-color: #ff4500 !important; } /* Orange */
        .cat-freizeit { border-left-color: #32cd32 !important; } /* Gr√ºn */
        .cat-sport { border-left-color: #ff1493 !important; } /* Pink */

        .task-time { font-size: 12px; color: var(--text-sec); margin-right: 10px; width: 45px;}
        .task-text { flex: 1; }
        .task-check { margin-left: 10px; transform: scale(1.2); accent-color: var(--primary); }

        /* NEWS SECTION */
        .news-card {
            background: var(--card);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 3px solid var(--text-sec);
        }
        .news-title { font-weight: bold; margin-bottom: 5px; display: block;}
        .news-meta { font-size: 11px; color: var(--text-sec); text-transform: uppercase;}
        .finance-ticker { display:flex; gap:10px; overflow-x:auto; padding-bottom:10px; margin-bottom:10px; }
        .ticker-item { background: #111; padding: 5px 10px; border-radius: 5px; font-size: 12px; white-space: nowrap; color: #00ff88; }

        /* AI CHAT */
        .chat-box {
            height: 300px;
            background: #151515;
            border-radius: 12px;
            padding: 10px;
            overflow-y: auto;
            margin-bottom: 10px;
            border: 1px solid #333;
        }
        .msg { margin-bottom: 8px; padding: 8px 12px; border-radius: 15px; max-width: 80%; font-size: 14px; }
        .msg.user { background: var(--primary); color: white; align-self: flex-end; margin-left: auto; }
        .msg.ai { background: #333; color: #ddd; align-self: flex-start; }

        /* DIARY */
        #diary-input { width: 95%; height: 200px; resize: none; background: var(--card); border: none; padding: 15px; }

        /* BOTTOM NAV */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #1a1a1a;
            border-top: 1px solid #333;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            padding-bottom: 20px; /* Safe area iPhone */
            z-index: 200;
        }
        .nav-btn {
            background: none;
            border: none;
            color: #666;
            font-size: 11px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
        }
        .nav-btn.active { color: var(--primary); }
        .nav-icon { font-size: 20px; }

        /* COLOR PICKER MODAL */
        #color-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 300; justify-content: center; align-items: center;
        }
        .color-grid { background: #222; padding: 20px; border-radius: 15px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .color-dot { width: 40px; height: 40px; border-radius: 50%; cursor: pointer; border: 2px solid #fff; }

    </style>
</head>
<body>

    <!-- HEADER -->
    <div class="header">
        <h1>NEXUS</h1>
        <div class="header-controls">
            <button class="icon-btn" onclick="openColorMenu()">üé®</button>
            <button class="icon-btn" onclick="manualUpload()">‚òÅÔ∏è‚¨Ü</button>
            <button class="icon-btn" onclick="manualDownload()">‚òÅÔ∏è‚¨á</button>
        </div>
    </div>

    <!-- CONTENT -->
    <div class="content">
        
        <!-- PLANNER VIEW -->
        <div id="view-planner" class="view-section active">
            <div class="date-control">
                <button class="icon-btn" onclick="changeDate(-1)">‚óÄ</button>
                <div class="date-display" id="date-display">Heute</div>
                <button class="icon-btn" onclick="changeDate(1)">‚ñ∂</button>
            </div>

            <button class="opt-btn" onclick="optimizeDay()">‚ö° KI: Tag optimieren</button>

            <div class="task-input-group">
                <input type="text" id="task-title" placeholder="Neue Aufgabe...">
                <div class="row">
                    <input type="time" id="task-time" style="width: 30%;">
                    <select id="task-cat" style="width: 70%;">
                        <option value="freizeit">Freizeit</option>
                        <option value="schule">Schule</option>
                        <option value="finanzen">Finanzen</option>
                        <option value="hausarbeit">Hausarbeit</option>
                        <option value="sport">Sport</option>
                    </select>
                </div>
                <button class="add-btn" onclick="addTask()">Hinzuf√ºgen</button>
            </div>

            <div id="task-list">
                <!-- Tasks go here -->
            </div>
        </div>

        <!-- NEWS VIEW -->
        <div id="view-news" class="view-section">
            <h2>Finanz News</h2>
            <div class="finance-ticker">
                <div class="ticker-item">DAX +1.2%</div>
                <div class="ticker-item" style="color:#ff5555">S&P 500 -0.4%</div>
                <div class="ticker-item">BTC $98,000</div>
                <div class="ticker-item">EUR/USD 1.08</div>
            </div>
            <div id="news-feed">
                <!-- News Fake Items -->
                <div class="news-card">
                    <span class="news-title">EZB h√§lt Leitzins stabil</span>
                    <span class="news-meta">Vor 10 Min ‚Ä¢ Finanzen</span>
                </div>
                <div class="news-card">
                    <span class="news-title">KI-Sektor w√§chst weiter rasant</span>
                    <span class="news-meta">Vor 2 Std ‚Ä¢ Technologie</span>
                </div>
            </div>
        </div>

        <!-- AI VIEW -->
        <div id="view-ai" class="view-section">
            <h2>KI Assistent</h2>
            <div class="chat-box" id="chat-box">
                <div class="msg ai">Hallo! Ich bin dein Nexus AI. Frag mich etwas oder lass uns deinen Plan besprechen.</div>
            </div>
            <div class="row">
                <input type="text" id="ai-input" placeholder="Frage eingeben..." style="width: 100%;">
                <button class="add-btn" onclick="askAI()" style="width: 60px; margin-top:0;">‚û§</button>
            </div>
        </div>

        <!-- DIARY VIEW -->
        <div id="view-diary" class="view-section">
            <h2>Tagebuch</h2>
            <textarea id="diary-input" placeholder="Liebes Tagebuch, heute war..." oninput="saveDiaryLocally()"></textarea>
            <p style="color: #666; font-size: 12px; text-align: center;">Wird automatisch lokal gespeichert.</p>
        </div>

    </div>

    <!-- BOTTOM NAVIGATION -->
    <div class="bottom-nav">
        <button class="nav-btn" onclick="switchTab('news')">
            <span class="nav-icon">üì∞</span> News
        </button>
        <button class="nav-btn active" onclick="switchTab('planner')">
            <span class="nav-icon">üìÖ</span> Planer
        </button>
        <button class="nav-btn" onclick="switchTab('ai')">
            <span class="nav-icon">ü§ñ</span> KI
        </button>
        <button class="nav-btn" onclick="switchTab('diary')">
            <span class="nav-icon">üìñ</span> Tagebuch
        </button>
    </div>

    <!-- COLOR MODAL -->
    <div id="color-modal" onclick="this.style.display='none'">
        <div class="color-grid" onclick="event.stopPropagation()">
            <div class="color-dot" style="background:#8a2be2" onclick="setColor('#8a2be2')"></div> <!-- Lila -->
            <div class="color-dot" style="background:#007aff" onclick="setColor('#007aff')"></div> <!-- Blau -->
            <div class="color-dot" style="background:#32cd32" onclick="setColor('#32cd32')"></div> <!-- Gr√ºn -->
            <div class="color-dot" style="background:#ff4500" onclick="setColor('#ff4500')"></div> <!-- Orange -->
            <div class="color-dot" style="background:#ff1493" onclick="setColor('#ff1493')"></div> <!-- Pink -->
            <div class="color-dot" style="background:#ffd700" onclick="setColor('#ffd700')"></div> <!-- Gold -->
        </div>
    </div>

    <script>
        // CONFIG & STATE
        // HIER DEINE API KEYS EINTRAGEN WENN DU WILLST (Sonst fragt er jedes Mal)
        let MASTER_KEY = ""; 
        let BIN_ID = "";     

        let currentDate = new Date();
        let currentTab = 'planner';
        
        // Data Structure
        let appData = {
            tasks: {}, // Format: "YYYY-MM-DD": [{text, time, cat, done}]
            diary: {},
            theme: '#8a2be2'
        };

        // INIT
        window.onload = function() {
            // Load LocalStorage if exists
            const saved = localStorage.getItem('nexus_data');
            if (saved) {
                appData = JSON.parse(saved);
                setColor(appData.theme || '#8a2be2');
            }
            updateDateDisplay();
            renderTasks();
            loadDiary();
        };

        // NAVIGATION
        function switchTab(tabId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById('view-' + tabId).classList.add('active');
            // Find button roughly (simple mapping)
            const btns = document.querySelectorAll('.nav-btn');
            if(tabId === 'news') btns[0].classList.add('active');
            if(tabId === 'planner') btns[1].classList.add('active');
            if(tabId === 'ai') btns[2].classList.add('active');
            if(tabId === 'diary') btns[3].classList.add('active');
            
            currentTab = tabId;
        }

        // CALENDAR LOGIC
        function formatDateKey(date) {
            return date.toISOString().split('T')[0];
        }

        function updateDateDisplay() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('date-display').innerText = currentDate.toLocaleDateString('de-DE', options);
            renderTasks();
            loadDiary();
        }

        function changeDate(days) {
            currentDate.setDate(currentDate.getDate() + days);
            updateDateDisplay();
        }

        // TASK LOGIC
        function addTask() {
            const title = document.getElementById('task-title').value;
            const time = document.getElementById('task-time').value;
            const cat = document.getElementById('task-cat').value;
            
            if (!title) return;

            const key = formatDateKey(currentDate);
            if (!appData.tasks[key]) appData.tasks[key] = [];

            appData.tasks[key].push({ title, time, cat, done: false });
            
            // Sort by time
            appData.tasks[key].sort((a, b) => a.time.localeCompare(b.time));

            document.getElementById('task-title').value = "";
            saveLocal();
            renderTasks();
        }

        function renderTasks() {
            const list = document.getElementById('task-list');
            list.innerHTML = "";
            const key = formatDateKey(currentDate);
            const tasks = appData.tasks[key] || [];

            tasks.forEach((task, index) => {
                const div = document.createElement('div');
                div.className = `task-item cat-${task.cat}`;
                div.innerHTML = `
                    <span class="task-time">${task.time || '--:--'}</span>
                    <span class="task-text" style="text-decoration: ${task.done ? 'line-through' : 'none'}">${task.title}</span>
                    <input type="checkbox" class="task-check" ${task.done ? 'checked' : ''} onchange="toggleTask(${index})">
                `;
                list.appendChild(div);
            });
        }

        function toggleTask(index) {
            const key = formatDateKey(currentDate);
            appData.tasks[key][index].done = !appData.tasks[key][index].done;
            saveLocal();
            renderTasks();
        }

        function optimizeDay() {
            alert("KI Analyse: Ich habe deinen Tag strukturiert. L√ºcken erkannt am Nachmittag. Empfehlung: 30min Sport einf√ºgen.");
            // Hier k√∂nnte man die Tasks automatisch umsortieren
        }

        // DIARY LOGIC
        function loadDiary() {
            const key = formatDateKey(currentDate);
            document.getElementById('diary-input').value = appData.diary[key] || "";
        }

        function saveDiaryLocally() {
            const key = formatDateKey(currentDate);
            if (!appData.diary) appData.diary = {};
            appData.diary[key] = document.getElementById('diary-input').value;
            saveLocal();
        }

        // AI LOGIC
        function askAI() {
            const input = document.getElementById('ai-input');
            const txt = input.value;
            if(!txt) return;

            const box = document.getElementById('chat-box');
            box.innerHTML += `<div class="msg user">${txt}</div>`;
            input.value = "";

            // Simple Simulation
            setTimeout(() => {
                let answer = "Das ist eine interessante Frage.";
                if(txt.toLowerCase().includes("finanz")) answer = "Die M√§rkte sind heute volatil. Ich empfehle Vorsicht bei Tech-Aktien.";
                if(txt.toLowerCase().includes("hallo")) answer = "Hallo! Wie kann ich dir bei deinem Plan heute helfen?";
                if(txt.toLowerCase().includes("plan")) answer = "Dein Tag sieht voll aus. Vergiss die Pause um 14:00 nicht.";
                
                box.innerHTML += `<div class="msg ai">${answer}</div>`;
                box.scrollTop = box.scrollHeight;
            }, 800);
        }

        // COLOR THEME
        function openColorMenu() { document.getElementById('color-modal').style.display = 'flex'; }
        
        function setColor(hex) {
            document.documentElement.style.setProperty('--primary', hex);
            appData.theme = hex;
            document.getElementById('color-modal').style.display = 'none';
            saveLocal();
        }

        // DATA SYNC (Manual Cloud)
        function saveLocal() {
            localStorage.setItem('nexus_data', JSON.stringify(appData));
        }

        async function manualUpload() {
            let key = MASTER_KEY || prompt("Bitte X-Master-Key eingeben:");
            let bin = BIN_ID || prompt("Bitte Bin-ID eingeben:");
            
            if(!key || !bin) return alert("Fehlende Daten!");

            try {
                const req = await fetch(`https://api.jsonbin.io/v3/b/${bin}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': key
                    },
                    body: JSON.stringify(appData)
                });
                if(req.ok) alert("‚úÖ Erfolgreich in der Cloud gespeichert!");
                else alert("‚ùå Fehler beim Upload");
            } catch(e) {
                alert("Verbindungsfehler: " + e);
            }
        }

        async function manualDownload() {
            let key = MASTER_KEY || prompt("Bitte X-Master-Key eingeben:");
            let bin = BIN_ID || prompt("Bitte Bin-ID eingeben:");
            
            if(!key || !bin) return alert("Fehlende Daten!");

            try {
                const req = await fetch(`https://api.jsonbin.io/v3/b/${bin}/latest`, {
                    method: 'GET',
                    headers: { 'X-Master-Key': key }
                });
                const json = await req.json();
                appData = json.record;
                saveLocal();
                
                // Refresh UI
                setColor(appData.theme || '#8a2be2');
                updateDateDisplay();
                alert("‚úÖ Daten erfolgreich geladen!");
            } catch(e) {
                alert("Fehler beim Download: " + e);
            }
        }

    </script>
</body>
</html>
