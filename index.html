<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS PRIME v51.1 | Fixed</title>
    <style>
        :root {
            --bg-color: #0a0a0a;
            --card-bg: #141414;
            --accent: #00d4ff;
            --text-main: #ffffff;
            --text-dim: #888888;
            --border: #333;
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font-family);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            padding-bottom: 90px;
        }

        /* HEADER */
        header {
            width: 100%;
            max-width: 1000px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 20px;
        }

        .logo { font-size: 1.5rem; font-weight: 700; letter-spacing: 2px; }
        .logo span { color: var(--accent); }
        
        .controls { display: flex; gap: 10px; align-items: center; }
        button {
            background: #222;
            border: 1px solid #333;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
        }
        button:hover { border-color: var(--accent); color: var(--accent); }

        /* LAYOUTS */
        /* WICHTIG: Display none/block wird per JS gesteuert */
        #layout-classic { width: 100%; max-width: 1000px; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        #layout-modern { width: 100%; max-width: 1000px; display: none; grid-template-columns: 1fr; gap: 20px; }

        /* CARDS */
        .card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
        h2 { font-size: 0.9rem; margin-bottom: 15px; color: var(--text-dim); text-transform: uppercase; }

        /* TEXTAREAS */
        textarea { width: 100%; background: #1a1a1a; border: 1px solid #333; color: white; padding: 15px; border-radius: 8px; min-height: 150px; resize: vertical; outline: none; }
        textarea:focus { border-color: var(--accent); }

        /* WIDGETS */
        .time-display { font-size: 2.5rem; font-weight: 700; text-align: center; }
        .date-display { text-align: center; color: var(--accent); margin-bottom: 10px; }

        /* BOTTOM NAV */
        .bottom-nav {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(20,20,20,0.95); backdrop-filter: blur(10px);
            border: 1px solid #333; border-radius: 50px;
            display: flex; gap: 25px; padding: 10px 25px;
            z-index: 100;
        }
        .nav-item { font-size: 1.4rem; cursor: pointer; opacity: 0.5; transition: 0.2s; }
        .nav-item.active { opacity: 1; color: var(--accent); transform: scale(1.1); }

        /* TAB CONTENT (Classic) */
        .tab-content { display: none; width: 100%; } /* Alle Tabs standardm√§√üig aus */
        .tab-content.active { display: block; } /* Nur aktiver Tab an */

        /* COLOR MENU */
        #color-menu { display: none; position: absolute; top: 70px; right: 20px; background: #222; padding: 10px; border-radius: 8px; border: 1px solid #444; z-index: 200; }
        .color-dot { width: 20px; height: 20px; border-radius: 50%; display: inline-block; margin: 5px; cursor: pointer; }

    </style>
</head>
<body>

    <header>
        <div class="logo">NEXUS <span>PRIME</span></div>
        <div class="controls">
            <button onclick="toggleColorMenu()">üé®</button>
            <button onclick="switchLayoutMode()">Mode: <span id="layout-label">Classic</span></button>
            <span id="status" style="font-size:0.7rem; color:#555;">Init...</span>
        </div>
    </header>

    <div id="color-menu">
        <div class="color-dot" style="background:#00d4ff" onclick="setColor('#00d4ff')"></div>
        <div class="color-dot" style="background:#ff0055" onclick="setColor('#ff0055')"></div>
        <div class="color-dot" style="background:#00ff88" onclick="setColor('#00ff88')"></div>
    </div>

    <!-- === CLASSIC LAYOUT === -->
    <div id="layout-classic">
        
        <!-- Tab 1: Home -->
        <div id="tab-home" class="tab-content active">
            <div class="card">
                <h2>Zeit</h2>
                <div class="time-display" id="clock-c">00:00</div>
                <div class="date-display" id="date-c">Datum</div>
            </div>
            <div class="card" style="margin-top:20px;">
                <h2>Notizen</h2>
                <textarea id="quick-notes" placeholder="Daily Notes..." oninput="autoSave()"></textarea>
            </div>
        </div>

        <!-- Tab 2: Journal -->
        <div id="tab-journal" class="tab-content">
            <div class="card">
                <h2>Tagebuch</h2>
                <textarea style="height:400px;" id="journal-text" placeholder="Mein Eintrag..." oninput="autoSave()"></textarea>
            </div>
        </div>

        <!-- Tab 3: Finance -->
        <div id="tab-finance" class="tab-content">
            <div class="card" style="height:500px;">
                <h2>Markt</h2>
                <!-- TradingView -->
                <div class="tradingview-widget-container" style="height:100%;width:100%"><div class="tradingview-widget-container__widget" style="height:100%;width:100%"></div><script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js" async>{"colorTheme": "dark","dateRange": "12M","showChart": true,"locale": "de_DE","width": "100%","height": "100%","isTransparent": true,"tabs": [{"title": "Portfolio","symbols": [{"s": "XETR:IUSQ"},{"s": "TVC:GOLD"}]}]}</script></div>
            </div>
        </div>

    </div>

    <!-- === MODERN LAYOUT === -->
    <div id="layout-modern">
        <div class="card" style="text-align: center; border:none; background:transparent;">
            <div class="time-display" id="clock-m" style="font-size:4rem; opacity:0.5;">00:00</div>
        </div>
        <div class="card">
            <h2>Deep Focus</h2>
            <textarea style="height:500px; font-size:1.2rem;" id="focus-text" placeholder="Focus Mode..." oninput="autoSave()"></textarea>
        </div>
    </div>

    <!-- NAV BAR (Nur f√ºr Classic) -->
    <div class="bottom-nav" id="bottom-nav">
        <div class="nav-item active" onclick="switchTab('home', this)">üè†</div>
        <div class="nav-item" onclick="switchTab('journal', this)">üìñ</div>
        <div class="nav-item" onclick="switchTab('finance', this)">üìà</div>
    </div>

    <script>
        // CONFIG
        const API_KEY = $2a$10$bfQHPAKf8rHB5nCB1nxla.8UbbBLCu6uCSZjrrePZ2JvQv9Jw3XEK; 
        const BIN_ID  = 6983be0443b1c97be965d28c;

        // APP LOGIC
        function updateTime() {
            const now = new Date();
            const t = now.toLocaleTimeString('de-DE', {hour:'2-digit', minute:'2-digit'});
            const d = now.toLocaleDateString('de-DE');
            document.getElementById('clock-c').innerText = t;
            document.getElementById('clock-m').innerText = t;
            document.getElementById('date-c').innerText = d;
        }
        setInterval(updateTime, 1000); updateTime();

        // LAYOUT SWITCHER (FIXED)
        function switchLayoutMode() {
            const classic = document.getElementById('layout-classic');
            const modern = document.getElementById('layout-modern');
            const nav = document.getElementById('bottom-nav');
            const label = document.getElementById('layout-label');

            // Pr√ºfen, ob Classic gerade sichtbar ist (display != none)
            if (classic.style.display !== 'none') {
                // Zu Modern wechseln
                classic.style.display = 'none';
                modern.style.display = 'grid';
                nav.style.display = 'none'; // Nav weg
                label.innerText = "Modern";
            } else {
                // Zu Classic wechseln
                modern.style.display = 'none';
                classic.style.display = 'grid';
                nav.style.display = 'flex'; // Nav wieder da
                label.innerText = "Classic";
            }
        }

        // TAB SWITCHER
        function switchTab(id, el) {
            // Alle Tabs aus
            document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
            // Gew√§hlten Tab an
            document.getElementById('tab-' + id).style.display = 'block';
            
            // Buttons reset
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }

        // COLORS
        function toggleColorMenu() {
            const m = document.getElementById('color-menu');
            m.style.display = m.style.display === 'block' ? 'none' : 'block';
        }
        function setColor(c) {
            document.documentElement.style.setProperty('--accent', c);
            toggleColorMenu();
        }

        // CLOUD SYNC
        let timer;
        async function loadData() {
            document.getElementById('status').innerText = "Syncing...";
            try {
                let r = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {headers:{"X-Master-Key":API_KEY}});
                let d = (await r.json()).record;
                if(d.quick) document.getElementById('quick-notes').value = d.quick;
                if(d.journal) document.getElementById('journal-text').value = d.journal;
                if(d.focus) document.getElementById('focus-text').value = d.focus;
                document.getElementById('status').innerText = "Online";
                document.getElementById('status').style.color = "var(--accent)";
            } catch(e) { document.getElementById('status').innerText = "Offline"; }
        }
        window.onload = loadData;

        function autoSave() {
            clearTimeout(timer);
            document.getElementById('status').innerText = "Typing...";
            timer = setTimeout(async () => {
                document.getElementById('status').innerText = "Saving...";
                let data = {
                    quick: document.getElementById('quick-notes').value,
                    journal: document.getElementById('journal-text').value,
                    focus: document.getElementById('focus-text').value
                };
                await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}`, {
                    method:"PUT", 
                    headers:{"Content-Type":"application/json", "X-Master-Key":API_KEY},
                    body:JSON.stringify(data)
                });
                document.getElementById('status').innerText = "Saved";
            }, 2000);
        }

        // Initial Layout State setzen (damit JS wei√ü was Phase ist)
        document.getElementById('layout-classic').style.display = 'grid';
        document.getElementById('layout-modern').style.display = 'none';

    </script>
</body>
</html>
